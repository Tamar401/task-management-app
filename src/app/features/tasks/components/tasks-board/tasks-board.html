<div class="tasks-container" role="main" aria-label="Task management board">
  <div class="header">
    <div class="header-right">
      <button mat-icon-button (click)="goBack()" aria-label="Go back">
        <mat-icon aria-hidden="true">arrow_forward</mat-icon>
      </button>
      <h1>Task Board</h1>
    </div>
    <button mat-raised-button color="primary" (click)="openTaskDialog()" aria-label="Add new task">
      <mat-icon aria-hidden="true">add</mat-icon>
      Add Task
    </button>
  </div>

  @if (loading()) {
    <div class="loading-spinner" role="status" aria-label="Loading tasks">
      <mat-spinner></mat-spinner>
    </div>
  } @else {
    <div class="board" role="region" aria-label="Task board with columns">
      <div class="column">
        <div class="column-header todo">
          <h2>To Do</h2>
          <span class="count" aria-label="Number of to-do tasks">{{ todoTasks().length }}</span>
        </div>
        <div 
          class="column-content"
          cdkDropList
          [cdkDropListData]="todoTasks()"
          (cdkDropListDropped)="onDrop($event, 'todo')"
          [cdkDropListConnectedTo]="['in_progress_list', 'done_list']"
          id="todo_list"
          role="region"
          aria-label="To-do tasks column">
          @for (task of todoTasks(); track task.id) {
            <app-task-card 
              [task]="task" 
              cdkDrag
              [cdkDragData]="task"
              (taskDeleted)="onTaskDeleted($event)"
              role="listitem"
              aria-label="Task: {{ task.title }}">
            </app-task-card>
          }
          @if (todoTasks().length === 0) {
            <div class="empty-column">
              <mat-icon>task_alt</mat-icon>
              <p>No tasks</p>
            </div>
          }
        </div>
      </div>

      <div class="column">
        <div class="column-header in-progress">
          <h2>In Progress</h2>
          <span class="count" aria-label="Number of in-progress tasks">{{ inProgressTasks().length }}</span>
        </div>
        <div 
          class="column-content"
          cdkDropList
          [cdkDropListData]="inProgressTasks()"
          (cdkDropListDropped)="onDrop($event, 'in_progress')"
          [cdkDropListConnectedTo]="['todo_list', 'done_list']"
          id="in_progress_list"
          role="region"
          aria-label="In-progress tasks column">
          @for (task of inProgressTasks(); track task.id) {
            <app-task-card 
              [task]="task" 
              cdkDrag
              [cdkDragData]="task"
              (taskDeleted)="onTaskDeleted($event)"
              role="listitem"
              aria-label="Task: {{ task.title }}">
            </app-task-card>
          }
          @if (inProgressTasks().length === 0) {
            <div class="empty-column">
              <mat-icon aria-hidden="true">pending_actions</mat-icon>
              <p>No tasks</p>
            </div>
          }
        </div>
      </div>

      <div class="column">
        <div class="column-header done">
          <h2>Completed</h2>
          <span class="count" aria-label="Number of completed tasks">{{ doneTasks().length }}</span>
        </div>
        <div 
          class="column-content"
          cdkDropList
          [cdkDropListData]="doneTasks()"
          (cdkDropListDropped)="onDrop($event, 'done')"
          [cdkDropListConnectedTo]="['todo_list', 'in_progress_list']"
          id="done_list"
          role="region"
          aria-label="Completed tasks column">
          @for (task of doneTasks(); track task.id) {
            <app-task-card 
              [task]="task" 
              cdkDrag
              [cdkDragData]="task"
              (taskDeleted)="onTaskDeleted($event)"
              role="listitem"
              aria-label="Task: {{ task.title }}">
            </app-task-card>
          }
          @if (doneTasks().length === 0) {
            <div class="empty-column">
              <mat-icon aria-hidden="true">done_all</mat-icon>
              <p>No tasks</p>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>